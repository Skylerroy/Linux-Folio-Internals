# 深入理解 Linux Folio

一本关于 Linux 内核 folio 抽象的全面技术书籍，涵盖从设计思想到代码实现的完整内容。

## 项目概述

本书详细介绍了 Linux 内核中 folio 的设计、实现和应用。folio 是 Linux 5.16 引入的新内存管理抽象，旨在替代传统的 `struct page`，提供更清晰、更高效的内存管理接口。

## 内容结构

### 主要章节

1. **第1章：导论 - 为什么需要 folio**
   - 传统 `struct page` 的局限性
   - folio 的诞生背景和动机
   - 设计目标和预期收益

2. **第2章：struct page 的历史与困境**
   - Linux 内存管理的历史演进
   - `struct page` 的设计问题分析
   - 复合页（Compound Page）的复杂性

3. **第3章：folio 的设计哲学**
   - Matthew Wilcox 的设计理念
   - 类型安全的重要性
   - API 设计原则
   - 渐进式迁移策略

4. **第4章：folio 核心数据结构**
   - `struct folio` 详细解析
   - 与 `struct page` 的关系
   - 引用计数机制
   - 标志位系统
   - 内存布局优化

5. **第5章：folio 与页缓存**
   - 页缓存架构的 folio 化改造
   - 文件读写操作优化
   - 预读算法改进
   - 性能基准测试

6. **第6章：folio 与文件系统**
   - VFS 层集成
   - 具体文件系统实现（ext4、XFS、NFS）
   - 性能优化策略
   - 调试和监控工具

7. **第7章：folio 的演进历史**
   - Linux 5.16-6.x 的发展过程
   - 关键特性的引入时间线
   - API 稳定化过程
   - 未来发展方向

8. **第8章：实践与迁移指南**
   - 从 page 到 folio 的迁移步骤
   - 兼容性处理
   - 调试技巧
   - 最佳实践

### 附录

- **附录A：folio API 参考手册**
  - 完整的 API 函数列表
  - 参数说明和使用示例
  - 错误处理指南

- **附录B：迁移指南**
  - 代码评估方法
  - 渐进式迁移策略
  - 测试和验证框架
  - 常见问题解决方案

- **附录C：索引**
  - 术语索引
  - 函数索引
  - 概念索引

## 技术特色

### 代码示例丰富
- 提供大量实际的内核代码示例
- 包含完整的函数实现和调用链
- 涵盖各种使用场景和边界情况

### 深度技术分析
- 详细的数据结构分析
- 内存布局和性能优化
- 并发安全和锁机制
- 调试和故障排除

### 实践导向
- 具体的迁移指南和最佳实践
- 性能调优建议
- 实际应用场景分析
- 测试和验证方法

## 编译要求

### 系统要求
- Linux 或 macOS 系统
- TeX Live 发行版（包含 LuaLaTeX）
- 中文字体支持

### 本地编译步骤

```bash
# 克隆项目
git clone <repository-url>
cd 深入理解Linux_Folio

# 设置执行权限
chmod +x build.sh

# 编译 PDF
./build.sh
```

编译后的 PDF 文件将生成在 `build/main.pdf` 和项目根目录下的 `深入理解Linux_Folio.pdf`。

### 自动化构建（CI/CD）

本项目配置了 GitHub Actions 自动构建流程，可以自动编译 PDF 文件。

#### 触发条件

- **Push 到主分支**：当代码推送到 `main` 或 `master` 分支时自动构建
- **Pull Request**：创建或更新 PR 时自动构建并验证
- **手动触发**：在 GitHub Actions 页面手动运行工作流
- **创建 Tag**：创建版本标签（如 `v1.0.0`）时自动构建并发布 Release

#### 获取构建产物

1. **从 Actions 下载**：
   - 进入仓库的 Actions 标签页
   - 选择对应的工作流运行
   - 在 Artifacts 区域下载生成的 PDF 文件

2. **从 Release 下载**（推荐）：
   - 创建版本标签触发自动发布
   - 在 Releases 页面下载对应版本的 PDF

#### 创建发布版本

```bash
# 创建版本标签
git tag -a v1.0.0 -m "Release version 1.0.0"
git push origin v1.0.0
```

GitHub Actions 会自动构建并创建 Release，附带生成的 PDF 文件。

#### 本地测试构建

在推送到 GitHub 之前，建议先在本地测试构建：

```bash
# 运行测试构建脚本
./test-build.sh
```

该脚本会：
- 清理之前的构建
- 验证项目结构和工具
- 运行完整构建
- 检查输出和日志
- 显示详细的构建报告

#### 故障排除

如果 GitHub Actions 构建失败：

1. **查看 Actions 日志**
   - 进入仓库的 Actions 标签页
   - 点击失败的工作流运行
   - 查看详细的构建日志

2. **下载构建日志**
   - 在失败的工作流页面
   - 下载 `build-logs-*` artifact
   - 查看 `build/main.log` 了解详细错误

3. **本地复现问题**
   ```bash
   # 运行测试脚本
   ./test-build.sh

   # 如果本地构建成功，可能是环境差异
   # 检查是否缺少必要的字体或包
   ```

4. **常见问题**
   - **缺少字体**: 确保安装了中文字体支持
   - **LaTeX 包缺失**: 安装完整的 TeX Live
   - **文件编码问题**: 确保所有 .tex 文件使用 UTF-8 编码
   - **路径问题**: 检查 chapters/ 和 appendix/ 目录中的文件

## 目标读者

- Linux 内核开发者
- 系统程序员
- 操作系统研究人员
- 计算机科学专业学生

## 先修知识

- 熟练掌握 C 语言
- 了解操作系统基本概念
- 有一定的 Linux 内核开发经验

## 内核版本支持

本书内容基于以下内核版本：
- Linux 5.16：folio 首次引入
- Linux 5.18：页缓存广泛应用
- Linux 6.0：API 稳定化
- Linux 6.x：当前成熟实现

## 许可证

本书基于 GPLv2 许可证发布。

## 致谢

特别感谢 Matthew Wilcox 对 folio 的杰出贡献，以及所有参与 Linux 内核开发的贡献者。

## 联系方式

如有问题或建议，请通过以下方式联系：
- 提交 GitHub Issues
- 发送邮件至：<your-email>

---
*最后更新：2026年2月*